(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["view-StartService-vue"],{"41af":function(e,t,a){"use strict";var n=a("d170");t.__esModule=!0,t.default=void 0;var r=n(a("0564")),i=a("e07b"),o=n(a("c350")),s=a("14ad"),u=a("e262"),c=(0,i.use)("datetime-picker"),l=c[0],h=c[1],m=(new Date).getFullYear(),d=l({mixins:[s.PickerMixin],props:{value:null,minHour:Number,minMinute:Number,type:{type:String,default:"datetime"},showToolbar:{type:Boolean,default:!0},format:{type:String,default:"YYYY.MM.DD HH时 mm分"},formatter:{type:Function,default:function(e,t){return t}},minDate:{type:Date,default:function(){return new Date(m-10,0,1)},validator:u.isValidDate},maxDate:{type:Date,default:function(){return new Date(m+10,11,31)},validator:u.isValidDate},maxHour:{type:Number,default:23},maxMinute:{type:Number,default:59}},data:function(){return{innerValue:this.correctValue(this.value)}},watch:{value:function(e){e=this.correctValue(e);var t="time"===this.type?e===this.innerValue:e.valueOf()===this.innerValue.valueOf();t||(this.innerValue=e,"time"===this.type&&this.updateColumnValue(e))},innerValue:function(e){this.$emit("input",e)},columns:function(){this.updateColumnValue(this.innerValue)}},computed:{ranges:function(){if("time"===this.type)return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];var e=this.getBoundary("max",this.innerValue),t=e.maxYear,a=e.maxDate,n=e.maxMonth,r=e.maxHour,i=e.maxMinute,o=this.getBoundary("min",this.innerValue),s=o.minYear,u=o.minDate,c=o.minMonth,l=o.minHour,h=o.minMinute,m=[{type:"year",range:[s,t]},{type:"month",range:[c,n]},{type:"day",range:[u,a]},{type:"hour",range:[l,r]},{type:"minute",range:[h,i]}];return"date"===this.type&&m.splice(3,2),"year-month"===this.type&&m.splice(2,3),m},columns:function(){var e=this,t=this.ranges.map(function(t){var a=t.type,n=t.range,r=(0,u.times)(n[1]-n[0]+1,function(t){var r=n[0]+t;return r=r<10?"0"+r:""+r,e.formatter(a,r)});return{values:r}});return t}},mounted:function(){this.updateColumnValue(this.innerValue)},methods:{correctValue:function(e){var t="time"!==this.type;if(t&&!(0,u.isValidDate)(e))e=this.minDate;else if(!e){var a=this.minHour;e=(a>10?a:"0"+a)+":00"}if(!t){var n=e.split(":"),r=n[0],o=n[1];return r=(0,u.padZero)((0,i.range)(r,this.minHour,this.maxHour)),o=(0,u.padZero)((0,i.range)(o,this.minMinute,this.maxMinute)),r+":"+o}return e=Math.max(e,this.minDate.getTime()),e=Math.min(e,this.maxDate.getTime()),new Date(e)},getBoundary:function(e,t){var a,n=this[e+"Date"],r=n.getFullYear(),i=1,o=1,s=0,c=0;return"max"===e&&(i=12,o=(0,u.getMonthEndDay)(t.getFullYear(),t.getMonth()+1),s=23,c=59),t.getFullYear()===r&&(i=n.getMonth()+1,t.getMonth()+1===i&&(o=n.getDate(),t.getDate()===o&&(s=n.getHours(),t.getHours()===s&&(c=n.getMinutes())))),a={},a[e+"Year"]=r,a[e+"Month"]=i,a[e+"Date"]=o,a[e+"Hour"]=s,a[e+"Minute"]=c,a},onConfirm:function(){this.$emit("confirm",this.innerValue)},onChange:function(e){var t,a=this;if("time"===this.type){var n=e.getIndexes();t=n[0]+this.minHour+":"+(n[1]+this.minMinute)}else{var r=e.getValues(),i=(0,u.getTrueValue)(r[0]),o=(0,u.getTrueValue)(r[1]),s=(0,u.getMonthEndDay)(i,o),c=(0,u.getTrueValue)(r[2]);"year-month"===this.type&&(c=1),c=c>s?s:c;var l=0,h=0;"datetime"===this.type&&(l=(0,u.getTrueValue)(r[3]),h=(0,u.getTrueValue)(r[4])),t=new Date(i,o-1,c,l,h)}this.innerValue=this.correctValue(t),this.$nextTick(function(){a.$nextTick(function(){a.$emit("change",e)})})},updateColumnValue:function(e){var t=this,a=[],n=this.formatter;if("time"===this.type){var r=e.split(":");a=[n("hour",r[0]),n("minute",r[1])]}else a=[n("year",""+e.getFullYear()),n("month",(0,u.padZero)(e.getMonth()+1)),n("day",(0,u.padZero)(e.getDate()))],"datetime"===this.type&&a.push(n("hour",(0,u.padZero)(e.getHours())),n("minute",(0,u.padZero)(e.getMinutes()))),"year-month"===this.type&&(a=a.slice(0,2));this.$nextTick(function(){t.$refs.picker.setValues(a)})}},render:function(e){var t=this,a={};return Object.keys(s.PickerMixin.props).forEach(function(e){a[e]=t[e]}),e(o.default,{class:h(),ref:"picker",attrs:{columns:this.columns},on:{change:this.onChange,confirm:this.onConfirm,cancel:function(){t.$emit("cancel")}},props:(0,r.default)({},a)})}});t.default=d},"79d7":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"start-service"},[a("van-field",{attrs:{disabled:"",label:"服务房源","input-align":"right",placeholder:"请输入服务房源",type:"text"},model:{value:e.houseName,callback:function(t){e.houseName=t},expression:"houseName"}}),1===e.data.houseType?a("van-field",{attrs:{required:"",disabled:"",clearable:"",label:"服务房间","input-align":"right",placeholder:"整套",type:"text"},model:{value:e.rooms,callback:function(t){e.rooms=t},expression:"rooms"}}):a("van-field",{attrs:{required:"",label:"服务房间","input-align":"right",placeholder:"请选择房间",type:"text",readonly:""},on:{click:function(t){e.roomShow=!0}},model:{value:e.rooms,callback:function(t){e.rooms=t},expression:"rooms"}}),a("van-field",{attrs:{required:"","input-align":"right",label:"预约服务时间",placeholder:"请选择时间",type:"text",readonly:""},on:{click:function(t){e.timeShow=!0}},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),a("div",{staticClass:"dec"},[a("p",[e._v("备注")]),a("van-field",{staticClass:"textarea",attrs:{"input-align":"left",placeholder:"请输入50字以内的备注",type:"textarea",autosize:e.autosize,maxlength:"50"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1),a("van-field",{attrs:{required:"",label:"联系人","input-align":"right",placeholder:"请输入联系人姓名",type:"text"},model:{value:e.ownerName,callback:function(t){e.ownerName=t},expression:"ownerName"}}),a("van-field",{attrs:{required:"",clearable:"",label:"联系电话","input-align":"right",placeholder:"请输入联系人电话",type:"text"},model:{value:e.ownerPhone,callback:function(t){e.ownerPhone=t},expression:"ownerPhone"}}),a("div",{staticClass:"service-footer"},[a("van-button",{staticClass:"service-btn",attrs:{slot:"button",size:"large",type:"default",loading:e.loading,"loading-text":"发起中..."},on:{click:e.startService},slot:"button"},[e._v("发起")])],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.roomShow,callback:function(t){e.roomShow=t},expression:"roomShow"}},[a("van-picker",{attrs:{"show-toolbar":"",columns:e.columns,title:"选择房间"},on:{confirm:e.roomConfirm,cancel:function(t){e.roomShow=!1}}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.timeShow,callback:function(t){e.timeShow=t},expression:"timeShow"}},[a("van-datetime-picker",{attrs:{type:"datetime",title:"选择时间","min-date":e.minDate,formatter:e.formatter},on:{confirm:e.confirmTime,cancel:function(t){e.timeShow=!1}},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1)],1)},r=[],i=a("5f19"),o=(a("3a23"),a("41af")),s=a.n(o),u=(a("f91a"),a("b5aa"),a("4457")),c=a("a585"),l=a("26cb"),h=a("fd86"),m=a("3d0b"),d=a("d26d"),p=a("3a61"),f=a("b2e6"),v=a("ccfe"),g=a("79f6"),y=function(e){function t(){var e;return Object(c["a"])(this,t),e=Object(h["a"])(this,Object(m["a"])(t).apply(this,arguments)),e.entrustId="",e.productId="",e.ownerName="",e.rooms="",e.roomId="",e.startTime="",e.roomShow=!1,e.ownerPhone="",e.houseName="",e.data={},e.remark="",e.timeShow=!1,e.columns=[],e.currentDate=new Date,e.minDate=new Date,e.loading=!1,e.autosize={minHeight:116},e}return Object(d["a"])(t,e),Object(l["a"])(t,[{key:"mounted",value:function(){this.entrustId=String(this.$route.query.entrustId),this.productId=String(this.$route.query.productId),this.getHouserInfo(this.entrustId)}},{key:"getHouserInfo",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(t){var a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$toast.loading({duration:0,mask:!0,loadingType:"spinner",message:"加载中..."}),e.prev=1,e.next=4,this.axios.get(g["a"].getHouserInfo+"/".concat(t));case 4:a=e.sent,a&&"000"===a.code?(this.data=a.data,this.houseName=a.data.houseName,this.ownerName=a.data.assetName,this.ownerPhone=a.data.assetPhone,1===a.data.houseType?this.rooms="整套":(n=a.data.rooms.map(function(e){return{text:e.roomName,value:e.roomId}}),this.columns=n)):this.$toast("获取服务类型失败"),e.next=11;break;case 8:throw e.prev=8,e.t0=e["catch"](1),new Error(e.t0||"Unknow Error!");case 11:return e.prev=11,this.$toast.clear(),e.finish(11);case 14:case"end":return e.stop()}},e,this,[[1,8,11,14]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"selectPro",value:function(e){if(0===e.ownerServiceTypes.length)return this.$toast("未找到有效订单，请先购买服务后发起"),!1;var t=e.ownerServiceTypes.map(function(e){return{text:e.label,value:e.value}});this.columns=t,this.timeShow=!0}},{key:"confirmTime",value:function(e){var t=e.toLocaleDateString().replace(/\//g,"-")+" "+e.toTimeString().substr(0,5);this.startTime=t,this.timeShow=!1}},{key:"roomConfirm",value:function(e){this.rooms=e.text,this.roomId=e.value,this.roomShow=!1}},{key:"startService",value:function(){return 0!==this.data.houseType||this.roomId?this.startTime?this.ownerName?this.ownerPhone?void this.submitData():(this.$toast("请输入联系人电话"),!1):(this.$toast("请输入联系人"),!1):(this.$toast("请选择时间"),!1):(this.$toast("请选择房间"),!1)}},{key:"submitData",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,a,n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={entrustId:this.entrustId,orderId:this.productId,ownerName:this.ownerName,remark:this.remark,roomId:0===this.data.houseType?this.roomId:"",roomName:0===this.data.houseType?this.rooms:"整租",subscribeTime:this.startTime,ownerPhone:this.ownerPhone},this.loading=!0,e.prev=2,e.next=5,this.axios.post(g["a"].pushService,t);case 5:a=e.sent,a&&"000"===a.code?(this.$toast.success("发起成功"),setTimeout(function(){n.$router.push("/myHouse?entrustId=".concat(n.entrustId))},2e3)):this.$toast(a.msg),e.next=12;break;case 9:throw e.prev=9,e.t0=e["catch"](2),new Error(e.t0||"Unknow Error!");case 12:return e.prev=12,this.loading=!1,e.finish(12);case 15:case"end":return e.stop()}},e,this,[[2,9,12,15]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"formatter",value:function(e,t){return"year"===e?"".concat(t,"年"):"month"===e?"".concat(t,"月"):"day"===e?"".concat(t,"日"):"hour"===e?"".concat(t,"时"):"minute"===e?"".concat(t,"分"):t}}]),t}(v["a"]);y=p["a"]([Object(f["a"])({name:"StartService",components:Object(i["a"])({},s.a.name,s.a)})],y);var w=y,b=w,x=(a("cf67"),a("8c9c")),k=Object(x["a"])(b,n,r,!1,null,null,null);t["default"]=k.exports},a8b0:function(e,t,a){},cf67:function(e,t,a){"use strict";var n=a("a8b0"),r=a.n(n);r.a},e262:function(e,t,a){"use strict";function n(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}function r(e){return("00"+e).slice(-2)}function i(e,t){var a=-1,n=Array(e);while(++a<e)n[a]=t(a);return n}function o(e){if(e){while(isNaN(parseInt(e,10)))e=e.slice(1);return parseInt(e,10)}}function s(e,t){return 32-new Date(e,t-1,32).getDate()}t.__esModule=!0,t.isValidDate=n,t.padZero=r,t.times=i,t.getTrueValue=o,t.getMonthEndDay=s}}]);